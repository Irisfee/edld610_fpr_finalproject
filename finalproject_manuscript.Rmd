---
title             : "Clickbait Title with SEO Keywords"
shorttitle        : "Clickbait Title"

author: 
  - name          : "Cameron S. Kay"
    affiliation   : "1"
    corresponding : yes    # Define only one corresponding author
    address       : "Department of Psychology, 1227 University of Oregon, Eugene, OR 97403"
    email         : "ckay@uoregon.edu"
  - name          : "Ashley L. Miller"
    affiliation   : "1"

affiliation:
  - id            : "1"
    institution   : "University of Oregon"

authornote: |
  Cameron Stuart Kay, Department of Psychology, University of Oregon; Ashley L. Miller, Department of Psychology, University of Oregon.

abstract: |
 Abstract goes herey
  
keywords          : "keywords"
wordcount         : "X"

bibliography      : ["r-references.bib"]

floatsintext      : no
figurelist        : no
tablelist         : no
footnotelist      : no
linenumbers       : no
mask              : no
draft             : no

header-includes:
  - \raggedbottom
  - \setlength{\parskip}{0pt}

documentclass     : "apa6"
classoption       : "man, fleqn, noextraspace"
output            : papaja::apa6_pdf
---

```{r setup, include = FALSE}
# load required packaages
library("papaja") # for creating the apa journal article
library(tidyverse) # for purrr, dplyr, and ggplot2 functions
library(rio) # for easy imporrting of data
library(here) # for reproducible paths
library(magrittr) # for the compound assigiment pipe-operator
library(lme4) # for conducting linear mixed-effects models
library(lmerTest) # for calculating t-tests for linear mixed-effects models

# import data as tibble and clean column names
data1 <- rio::import(here::here("data", "data_1.xlsx"), setclass = "tibble") %>%
  janitor::clean_names()

# turn off scientific notation
options(scipen = 999)
```

```{r renamecols_data1, include = FALSE}
# drop the display order columns and the other columns
data1 %<>%
  select(-contains("do"),
         -contains("text"))

# manualy rename the demographic columns
data1 %<>%
  rename(age          = q1_1,
         gender       = q1_2,
         race         = q1_4)


# create vectors of subscale names for renaming the columns
d3_traits    <- c("mach", "narc", "psyc")

sns          <- c("facebook", 
                  "pinterest", 
                  "instagram", 
                  "linkedin", 
                  "twitter", 
                  "snapchat", 
                  "youtube", 
                  "whatsapp", 
                  "reddit", 
                  "4chan", 
                  "tumblr")
 
int_motives  <- c("inform", 
                  "interp", 
                  "entert")
 
sns_addict   <- c("salience",
                  "tolerance",
                  "mood",
                  "relapse",
                  "withdraw",
                  "conflict")

sns_contexts <- c("society",
                  "self")

# create a tibble containing all the necessary information for renaming the columns
data_rename <- tibble(scale_names = c("dd",
                                      "freq",
                                      "len",
                                      "sns_perc",
                                      "int_mot",
                                      "int_addict"),
                      sub_names   = list(d3_traits,
                                         sns,
                                         sns,
                                         sns_contexts,
                                         int_motives,
                                         sns_addict),
                      scale_lens  = c(12, 11, 11, 2, 20, 18),
                      sub_lens    = list(4, 1, 1, 1, c(8, 7, 5), 3))

# create a function for detecting columns names from a string
col_match <- function(pattern, data) {
  
  # ensure pattern is a character and the data is a dataframe
  if (!is.character(pattern)) {
    stop("Pattern must be of type character.")
  } else if (!is.data.frame(data)) {
    stop("Data must of type dataframe/tibble.")
  }
  
  # return colnumn names that contain the pattern
  grepl(pattern, names(data))
}

# create a function for creating column names
name_creator <- function(scale_name, sub_name, scale_len, sub_len) {
  
  # calculate the subscale length if no subscale length provided
  if (missing(sub_len)) {
    sub_len <- scale_len / length(sub_name)
  }
  
  # create a vector of subscale names to match length of the scale
  if (length(sub_len) == 1) {
    sub_vector <- rep(sub_name, each = sub_len)
    
  } else {
    sub_vector <- rep(sub_name, times = sub_len)
  }

  # paste the values together
  scale_sub <- paste(scale_name, sub_vector, sep = "_")
  
  # if sub_len != 1, add item numbers
  if (any(sub_len != 1)) {
    # create a vector of item numbers
    item_nums <- rep(flatten_dbl(map(sub_len, seq_len)), times = scale_len / sum(sub_len))
    # combine scale_sub with the item_nums
    scale_sub <- paste(scale_sub, item_nums, sep = "_")
  }
  
  # return scale_sub
  scale_sub
  
}

# iterate through data_rename and create a list of column names
col_names <- pmap(list(data_rename$scale_names,
                       data_rename$sub_names,
                       data_rename$scale_lens,
                       data_rename$sub_lens),
                  ~name_creator(..1, ..2, ..3, ..4)
)

# assign created column names to data1
names(data1)[col_match("q7", data1)] <- unlist(col_names)

# remove uneeded variables
rm(list = setdiff(ls(), "data1"))
```

```{r tidy_data1}
# factorize and label factors
data1 %<>%
  mutate(gender = factor(gender, labels = c("Male",
                                            "Female",
                                            "Non-binary",
                                            "Prefer not to say",
                                            "Other")),
         race   = factor(race, labels = c("American Indian or Alaska Native",
                                          "Asian",
                                          "Black or African American",
                                          "Native Hawaiian or Other Pacific Islander",
                                          "Caucasian",
                                          "Hispanic, Latinx, or Spanish Origin",
                                          "Middle Eastern or North African",
                                          "I prefer not to answer",
                                          "Some other ethnicity or origin")))

# add an id column
data1 %<>%
  mutate(id = 1:n()) %>%
  select(id, everything())

# create a column for sns, and tow others for the frequency and length
data1 %<>%
  gather("key", "value", freq_facebook:len_tumblr) %>%
  separate(key, into = c("variable", "sns"), sep = "_") %>%
  spread(variable, value)

# turn the self and society perception into long format
data1 %<>%
  gather("sns_perc_context", "sns_perc_rating", starts_with("sns_perc")) %>%
  mutate(sns_perc_context = gsub(".*_", "", sns_perc_context))


# create a range function
range_mean <- function(x) {
  as.character(mean(as.numeric(strsplit(str_extract(x, "\\d*-\\d*"), "-")[[1]])))
}

data1[grepl("-", data1$len), "len"] <- apply(data1[grepl("-", data1$len), "len"], 
                                             MARGIN = 1, 
                                             range_mean)

data1 %<>%
  mutate(len_unit  = case_when(grepl("(hour|hr)", len) ~ 60,
                               TRUE                    ~ 1),
         len_clean = case_when(len == "ten"                  ~ 10,
                               len == "3o"                   ~ 30,
                               len == "sixty"                ~ 60,
                               len == "eighty"               ~ 80,
                               grepl("(zero|no|never)", len) ~ 0,
                               TRUE                          ~ parse_number(len)),
         len       = len_clean * len_unit) %>%
  select(-len_unit, -len_clean)


```

Sagacious intro text goes here.

# Method

## Participants

## Material and procedure

## Data analysis

# Results

# Discussion

\newpage

# References
```{r create_r-references}
r_refs(file = "r-references.bib")
```

\begingroup
\setlength{\parindent}{-0.5in}
\setlength{\leftskip}{0.5in}

<div id = "refs"></div>
\endgroup
