---
title             : "Clickbait Title with SEO Keywords"
shorttitle        : "Clickbait Title"

author: 
  - name          : "Cameron S. Kay"
    affiliation   : "1"
    corresponding : yes    # Define only one corresponding author
    address       : "Department of Psychology, 1227 University of Oregon, Eugene, OR 97403"
    email         : "ckay@uoregon.edu"
  - name          : "Ashley L. Miller"
    affiliation   : "1"

affiliation:
  - id            : "1"
    institution   : "University of Oregon"

authornote: |
  Cameron Stuart Kay, Department of Psychology, University of Oregon; Ashley L. Miller, Department of Psychology, University of Oregon.

abstract: |
 Abstract goes herey
  
keywords          : "keywords"
wordcount         : "X"

bibliography      : ["r-references.bib"]

floatsintext      : no
figurelist        : no
tablelist         : no
footnotelist      : no
linenumbers       : no
mask              : no
draft             : no

header-includes:
  - \raggedbottom
  - \setlength{\parskip}{0pt}

documentclass     : "apa6"
classoption       : "man, fleqn, noextraspace"
output            : papaja::apa6_pdf
---

```{r setup, include = FALSE}
# load required packaages
library("papaja") # for creating the apa journal article
library(tidyverse) # for purrr, dplyr, and ggplot2 functions
library(rio) # for easy imporrting of data
library(here) # for reproducible paths
library(magrittr) # for the compound assigiment pipe-operator
library(lme4) # for conducting linear mixed-effects models
library(lmerTest) # for calculating t-tests for linear mixed-effects models

# import data as tibble and clean column names
data1 <- rio::import(here::here("data", "data_1.xlsx"), setclass = "tibble") %>%
  janitor::clean_names()

# turn off scientific notation
options(scipen = 999)
```

```{r clean_data1, include = FALSE}
# drop the display order columns
data1 %<>%
  select(-contains("do"))

# manualy rename the demographic columns
data1 %<>%
  rename(age          = q1_1,
         gender       = q1_2,
         gender_other = q1_2_5_text,
         race         = q1_4,
         race_other   = q1_4_10_text)


# create vectors of labels to use for renaming the columns
d3_traits    <- c("mach", "narc", "psyc")
   
sns          <- c("facebook", 
                  "pinterest", 
                  "instagram", 
                  "linkedin", 
                  "twitter", 
                  "snapchat", 
                  "youtube", 
                  "whatsapp", 
                  "reddit", 
                  "4chan", 
                  "tumblr")
 
int_motives  <- c("inform", 
                  "interp", 
                  "entert")
 
sns_addict   <- c("salience",
                  "tolerance",
                  "mood",
                  "relapse",
                  "withdraw",
                  "conflict")

sns_contexts <- c("society",
                  "self")


data_rename <- tibble(col_ids = c("q737",
                                  "q738",
                                  "q7(5|6[0-3])",
                                  "q764",
                                  "q765",
                                  "q766"),
                      scale_names = c("dd",
                                      "freq",
                                      "len",
                                      "sns_perc",
                                      "int_mot",
                                      "int_addict"),
                      sub_names   = list(d3_traits,
                                         sns,
                                         sns,
                                         sns_contexts,
                                         int_motives,
                                         sns_addict),
                      scale_lens  = c(12, 11, 11, 2, 20, 18),
                      sub_lens    = list(4, 1, 1, 1, c(8, 7, 5), 3))






# create a function for detecting columns names from a string
col_match <- function(pattern, data) {
  
  # ensure pattern is a character and the data is a dataframe
  if (!is.character(pattern)) {
    stop("Pattern must be of type character.")
  } else if (!is.data.frame(data)) {
    stop("Data must of type dataframe/tibble.")
  }
  
  # return colnumn names that contain the pattern
  grepl(pattern, names(data))
}

# create function for creating names
name_creator <- function(scale_name, sub_name, scale_len, sub_len) {
  
  # calculate the subscale length if no subscale length provided
  if (missing(sub_len)) {
    sub_len <- scale_len / length(sub_name)
  }
  
  # create a vector of subscale names to match length of the scale
  if (length(sub_len) == 1) {
    sub_vector <- rep(sub_name, each = sub_len)
    
  } else {
    sub_vector <- rep(sub_name, times = sub_len)
  }

  # paste the values together
  scale_sub <- paste(scale_name, sub_vector, sep = "_")
  
  # if sub_len != 1, add item numbers
  if (any(sub_len != 1)) {
    # create a vector of item numbers
    item_nums <- rep(flatten_dbl(map(sub_len, seq_len)), times = scale_len / sum(sub_len))
    # combine scale_sub with the item_nums
    scale_sub <- paste(scale_sub, item_nums, sep = "_")
  }
  
  # return scale_sub
  scale_sub
  
}




# for (i in seq_len(nrow(data_rename))) {
#   names(data1)[col_match(data_rename$col_ids[i], data1)] <- name_creator(data_rename$scale_names[i], 
#                                                              data_rename$sub_names[[i]], 
#                                                              data_rename$scale_lens[i], 
#                                                              data_rename$sub_lens[[i]])
# }


col_names <- pmap(list(scale_names  = data_rename$scale_names,
                       sub_names    = data_rename$sub_names,
                       scale_lens   = data_rename$scale_lens,
                       sub_lens     = data_rename$sub_lens),
                  function(scale_names, sub_names, scale_lens, sub_lens) {
                    name_creator(scale_names, sub_names, scale_lens, sub_lens)
})

col_names <- pmap(list(data_rename$scale_names,
                       data_rename$sub_names,
                       data_rename$scale_lens,
                       data_rename$sub_lens),
                   ~name_creator(..1, ..2, ..3, ..4)
)

names(data1)[col_match("q7", data1)] <- unlist(col_names)
```

Sagacious intro text goes here.

# Method

## Participants

## Material and procedure

## Data analysis

# Results

# Discussion

\newpage

# References
```{r create_r-references}
r_refs(file = "r-references.bib")
```

\begingroup
\setlength{\parindent}{-0.5in}
\setlength{\leftskip}{0.5in}

<div id = "refs"></div>
\endgroup
